# GitHub Copilot コードレビュー手順

このファイルは、本リポジトリのコードレビューに関する包括的なガイダンスを提供し、テスト標準とレビューのベストプラクティスに焦点を当てています。

## 1. コードレビューガイドライン（重要）

コードレビューを実施する際は、**必ず** 以下の項目を確認してください。

### レビュー通信
- **日本語でコメント**: すべてのレビューコメントは日本語で記述すること
- **具体的なコード例を提供**: レビューフィードバック には具体的なコード例を含めること

### コード品質チェック
- **スペルチェック と構文**: スペルミスや構文ミスなど人が見落としやすい部分を確認
- **命名規則**: 命名規則が一般的なものと異なっていないか確認。カスタムまたは異常なパターンを使用していないか確認

### アーキテクチャと設計
- **レイヤードアーキテクチャ**: コードがレイヤードアーキテクチャの原則に適切に従っているか確認
- **役割分担**: DTO、Entity などの役割が混ざっていないか、適切に役割分担できているか確認
  - DTO: API レイヤーのリクエスト/レスポンスオブジェクト
  - Entity: JPA エンティティとビジネスロジック
  - Service: ビジネスロジック統合
  - Repository: データアクセスレイヤー


### API 設計
- **REST 原則**: API 仕様が REST 原則に沿っているか確認
  - 適切な HTTP メソッド（GET、POST、PUT、DELETE）
  - 正しいステータスコード（200、201、400、404、409 など）
  - リソースベース URL
  - ステートレス通信

### エラーハンドリングとパフォーマンス
- **例外処理**: 例外処理がコードベース全体で統一されているか確認
  - 一元化されたエラーハンドリングに `GlobalExceptionHandler` を使用
  - 適切なカスタム例外（`EntityNotFoundException`、`DuplicationResourceException`）をスロー
- **パフォーマンス最適化**: 最適化の機会やパフォーマンス改善の可能性を確認
  - 不要なデータベースクエリ
  - N+1 クエリ問題
  - インデックスの欠落
  - 非効率なアルゴリズム

### レビューチェックリスト

すべてのコードレビューでこのチェックリストを使用してください：
- [ ] コメントは日本語で記述されている
- [ ] フィードバックに具体的なコード例が含まれている
- [ ] スペルミスまたは構文エラーがない
- [ ] 命名規則が標準的で一貫している
- [ ] レイヤードアーキテクチャが適切に適用されている
- [ ] DTO と Entity が適切に分離されている
- [ ] REST 原則に従っている
- [ ] 例外処理が一貫している
- [ ] パフォーマンスが最適化されている
- [ ] 明らかな改善の機会がない

## 2. 開発ガイドライン（重要）

1. **論理削除**: **必ず** `isDeleted=true` で論理削除を使用します。レコード物理削除は禁止。
2. **検証**: すべての DTO に Jakarta Bean Validation アノテーション（`@NotNull`、`@Size`、`@Min`、`@Max`）を使用
3. **Lombok**: ボイラープレート削減のため Lombok アノテーション（`@Data`、`@Builder`、`@NoArgsConstructor`、`@AllArgsConstructor`）を使用
4. **トランザクション**: データ変更するサービスメソッドは **必ず** `@Transactional` アノテーションを付与
5. **部分更新**: `EntityHelper.updateIfNotNull()` をオプショナルフィールド更新に使用
6. **ページネーション**: デフォルト page=1、limit=20、最大 limit=100
7. **命名**: 既存パターンに従う（例：`{リソース}Controller`、`{リソース}Service`）

### API エンドポイントパターン

すべてのリソースは一貫した CRUD パターンに従う：
- `GET /{resources}` - リスト（ページネーション付き）（`page`、`limit`、`sort` クエリパラメータ）
- `POST /{resources}` - 作成（201 Created を返す）
- `PUT /{resources}/{id}` - 更新（200 OK を返す）
- `DELETE /{resources}/{id}` - 論理削除（204 No Content を返す）

### テストガイドライン

1. 完全なテスト要件については `TEST_DESIGN_SPECIFICATION_FOR_UNITTEST.md` を参照
2. テンプレートとして `ArtistControllerTest.java` と `ArtistServiceTest.java` を使用
3. 機能実装前にテストを作成する（TDD アプローチを推奨）
4. 100% カバレッジ（行、分岐、メソッド）を目指す
5. 成功パスと失敗パスの両方をテスト
6. エッジケースと境界条件を含める

### コード品質

- 既存のコードパターンと構造に従う
- 明確で説明的なテスト名を記述
- public メソッドに JavaDoc コメントを追加（既存スタイルに合わせる）
- メソッドを単一責任に保つ
- 意味のある変数名を使用

## 3. テスト標準（参考）

**参照ドキュメント**: `src/test/TEST_DESIGN_SPECIFICATION_FOR_UNITTEST.md` はテスト標準の権威的なソースです。テストを作成する際は必ず参照してください。

### テスト命名規約

```
{メソッド名}{Success|Error}[_with{条件}][_{詳細}]
```

例：
- `createArtistSuccess`
- `createArtistError_withBadRequest_RequiredFieldNull`
- `updateArtistSuccess_PartialUpdate`

### コントローラテスト

**アノテーション**: `@WebMvcTest({リソース}Controller.class)`

**重要な実践**：
- HTTP テストに `MockMvc` を使用
- `@MockitoBean` でサービスをモック
- すべての HTTP ステータスコード（200、201、400、404、409 など）をテスト
- リクエスト検証を検証
- `jsonPath` で JSON レスポンス構造を確認

**必須テストケース**（エンドポイントごと）：
- **POST**: 成功、必須フィールド null、長さ超過、一意制約
- **GET（リスト）**: デフォルトパラメータ、ページネーション、ページ/リミット不正
- **PUT**: すべてのフィールド、部分更新、見つからない、長さ超過、一意制約、無効なID
- **DELETE**: 成功、見つからない

### サービステスト

**アノテーション**: `@ExtendWith(MockitoExtension.class)`

**重要な実践**：
- `@Mock` でリポジトリをモック
- `@InjectMocks` でサービスをインジェクト
- ビジネスロジックと例外シナリオをテスト
- `verify()` でリポジトリメソッド呼び出しを検証

**必須テストケース**（メソッドごと）：
- **create**: 成功、重複エラー
- **getAll**: ASC ソート、DESC ソート、空リスト
- **update**: すべてのフィールド、部分更新、同じ値（一意フィールド）、すべて null、見つからない、重複
- **delete**: 成功、見つからない

### カバレッジ目標

- **行カバレッジ**: 100%
- **分岐カバレッジ**: 100%
- **メソッドカバレッジ**: 100%

### 参照実装

- `ArtistControllerTest.java`: 16 テストケース
- `ArtistServiceTest.java`: 13 テストケース

---

**Last Updated**: 2026-02-19
**Version**: 2.0.0
